# @nocobase/plugin-enhanced-table-block

## 介绍

`@nocobase/plugin-enhanced-table-block` 是 NocoBase 的一款增强表格区块插件。它提供了更加灵活且高级的表格功能，以改善应用程序中的数据可视化和操作体验。

## 特性

- **合计行 (Summary Row)：** 在表格底部自动显示合计行，用于展示聚合数据（如：求和、平均值、计数等）。
- **圈选求和 (Cell Selection Sum)：** 通过在表格中拖拽圈选多个数值单元格，快速计算并显示它们的总和。
- **增强的交互体验：** 优化了表格单元格和内容的交互行为。
- **跨版本兼容：** 同时支持并在 NocoBase 的 V1 和 V2 页面版本中无缝工作。

## 安装

这是 NocoBase 的内置核心区块插件。如果未启用，你可以通过 NocoBase 后台的插件管理器进行安装和启用，或者使用 CLI 命令：

```bash
yarn nocobase plugin install @nocobase/plugin-enhanced-table-block
```

## 使用方法

1. 进入你需要添加表格的任意 NocoBase 页面。
2. 点击 **添加区块 (Add block)**，并在列表中选择 **增强表格 (Enhanced Table)**。
3. 配置该区块的数据源和数据表。
4. 在区块设置中启用 **合计行** 功能，系统会自动为你指定的列计算并展示聚合结果。
5. 在数据视图中，你可以通过鼠标拖拽选中多个包含数字的单元格，系统将自动汇总并在界面上向你展示求和结果。

## 更新日志

**v2.1.0-beta.7**
- **重构：** 取消了原先基于正则判断数字段的逻辑，替换成了更严谨且准确的底层组件元数据类型映射遍历机制，彻底避免把时间或文本误判为数字并相加的错误。
- **修复：** 移除了 `e.preventDefault()` 并加入选区清除机制，恢复了鼠标在单元格内拖动选取文字和复制的常规浏览器体验。
- **优化：** 鼠标圈选统计悬浮窗现在限定在选中 >1 个单元格时才弹出，不再干扰单次点击和单格选择。
- **功能扩充：** 圈选效果的统计浮窗现在抛弃了简单的加和，转为显示所选范围的最大值、最小值、平均值及有效单元格计数。
- **样式优化：** 全部文案从“合计行”被更名校正为“汇总行”，且底部统计栏的内容变更为靠右对齐呈现以契合财务阅读视觉。

**v2.1.0-beta**
- **修复：** 旧版 V1 页面因 `resource:list` 接口未绑定导致的 404 及无法计算合计结果的问题。
- **优化：** 在后台给区块开启项配置时，将安全隐藏所有非数字类型（如富文本、关联数据、日期）的配置栏，而不再是使用 `disabled` 进行占位展示。
- **修复：** 修正了 V1 Initializers 菜单下插件名称没有正确载入中文名而在新装区块时展示占位 key 的表现。

## 协议

AGPL-3.0
